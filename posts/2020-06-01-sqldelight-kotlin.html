<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hampus Londögård">
<meta name="dcterms.date" content="2020-06-01">
<meta name="description" content="In this post different abstraction levels of SQL is discussed with the final SQLDelight which turns the abstraction into the reverse.">

<title>Londogard Blog - SQL - Different Abstraction Levels (&amp; how I came to love SQLDelight)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="Londogard Blog - SQL - Different Abstraction Levels (&amp; how I came to love SQLDelight)">
<meta name="twitter:description" content="In this post different abstraction levels of SQL is discussed with the final SQLDelight which turns the abstraction into the reverse.">
<meta name="twitter:creator" content="@hlondogard">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Londogard Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pages/presentations.html" rel="" target="">
 <span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://londogard.com/projects" rel="" target="">
 <span class="menu-text">Londogard Projects↗</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pages/about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/code_setup/code_setup.html" rel="" target="">
 <span class="menu-text">Dev Setup</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hampus-londögård/" rel="" target=""><i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hlondogard" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/lundez" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Lundez</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/londogard" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Londogard</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml" rel="" target=""><i class="bi bi-rss" role="img" aria-label="Londogard Blog RSS">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">SQL - Different Abstraction Levels (&amp; how I came to love SQLDelight)</h1>
                  <div>
        <div class="description">
          In this post different abstraction levels of SQL is discussed with the final SQLDelight which turns the abstraction into the reverse.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">jvm</div>
                <div class="quarto-category">kotlin</div>
                <div class="quarto-category">db</div>
                <div class="quarto-category">multiplatform</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hampus Londögård </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 1, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sql---different-abstraction-levels-and-how-i-came-to-love-sqldelight" id="toc-sql---different-abstraction-levels-and-how-i-came-to-love-sqldelight" class="nav-link active" data-scroll-target="#sql---different-abstraction-levels-and-how-i-came-to-love-sqldelight">SQL - different abstraction levels and how I came to love SQLDelight</a>
  <ul class="collapse">
  <li><a href="#how-to-interact-with-a-sql-database-from-a-programming-language" id="toc-how-to-interact-with-a-sql-database-from-a-programming-language" class="nav-link" data-scroll-target="#how-to-interact-with-a-sql-database-from-a-programming-language">How to interact with a SQL Database from a programming language</a></li>
  <li><a href="#moving-one-abstraction-level-up" id="toc-moving-one-abstraction-level-up" class="nav-link" data-scroll-target="#moving-one-abstraction-level-up">Moving one abstraction level up</a></li>
  <li><a href="#moving-another-level-up-python-peewee" id="toc-moving-another-level-up-python-peewee" class="nav-link" data-scroll-target="#moving-another-level-up-python-peewee">Moving another level up (Python + Peewee)</a></li>
  <li><a href="#sqldelight-abstraction-level-left-to-the-right" id="toc-sqldelight-abstraction-level-left-to-the-right" class="nav-link" data-scroll-target="#sqldelight-abstraction-level-left-to-the-right">SQLDelight: Abstraction level left to the right</a></li>
  <li><a href="#comparison-table" id="toc-comparison-table" class="nav-link" data-scroll-target="#comparison-table">Comparison Table</a></li>
  <li><a href="#outro" id="toc-outro" class="nav-link" data-scroll-target="#outro">Outro</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="sql---different-abstraction-levels-and-how-i-came-to-love-sqldelight" class="level1">
<h1>SQL - different abstraction levels and how I came to love SQLDelight</h1>
<p>In this blog I’ll cover a few different abstraction levels of database access, focusing purely on SQL and not NoSQL / Reddis or anything like that. The purpose is to share the knowledge that there exist these types of abstractions and they do exist in all or at least most of the popular languages. <!--truncate--> I’ll try to move from "raw SQL" to the modern "Object-Relational Mapping"-style, a.k.a ORM.</p>
<p>In the end I wish to make a short piece leaving out a lot of details but maintaining a feel of each style and some pros/cons. I bet you already guessed my preferred approach straight from the title :wink:.</p>
<section id="how-to-interact-with-a-sql-database-from-a-programming-language" class="level3">
<h3 class="anchored" data-anchor-id="how-to-interact-with-a-sql-database-from-a-programming-language">How to interact with a SQL Database from a programming language</h3>
<p>Structured Query Language (SQL) is as the name, once spelled out, a Domain Specific Language (DSL) just like regex. It’s basically a programming language written to facilitate and simplify the experience with the underlying engine. By using a DSL you gain capabilities that would be natural to integrate with most languages, and it also makes the engine do the same with the same code across languages.</p>
<p>I think that Regex and SQL are the most famous DSLs and for good reason, having regex work (almost) the same across languages simplifies the guides and the same applies to SQL.</p>
<p>Going forward let’s see how we communicate with a SQL-db from a programming language like Java using their famous jdbc (Java Database Connectivity) which is the driver that communicates with the db.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode kotlin code-with-copy"><code class="sourceCode kotlin"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>println<span class="op">(</span>\<span class="st">"Connecting to database...</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      conn <span class="op">=</span> DriverManager<span class="op">.</span>getConnection<span class="op">(</span>DB_URL<span class="op">,</span>USER<span class="op">,</span>PASS<span class="op">);</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">//STEP 4: Execute a query</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>println<span class="op">(</span>\<span class="st">"Creating statement...</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      stmt <span class="op">=</span> conn<span class="op">.</span>createStatement<span class="op">();</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">String</span> sql<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      sql <span class="op">=</span> \<span class="st">"SELECT id, first, last, age FROM Employees</span><span class="sc">\"</span><span class="st">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      ResultSet rs <span class="op">=</span> stmt<span class="op">.</span>executeQuery<span class="op">(</span>sql<span class="op">);</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">//STEP 5: Extract data from result set</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span><span class="op">(</span>rs<span class="op">.</span>next<span class="op">()){</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         <span class="co">//Retrieve by column name</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         int id  <span class="op">=</span> rs<span class="op">.</span>getInt<span class="op">(</span>\<span class="st">"id</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         int age <span class="op">=</span> rs<span class="op">.</span>getInt<span class="op">(</span>\<span class="st">"age</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="kw">String</span> first <span class="op">=</span> rs<span class="op">.</span>getString<span class="op">(</span>\<span class="st">"first</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         <span class="kw">String</span> last <span class="op">=</span> rs<span class="op">.</span>getString<span class="op">(</span>\<span class="st">"last</span><span class="sc">\"</span><span class="st">);</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="co">//Display values</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>print<span class="op">(</span>\<span class="st">"ID: </span><span class="sc">\"</span><span class="st"> + id);</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>         System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>print<span class="op">(</span>\<span class="st">", Age: </span><span class="sc">\"</span><span class="st"> + age);</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>         System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>print<span class="op">(</span>\<span class="st">", First: </span><span class="sc">\"</span><span class="st"> + first);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>         System<span class="op">.</span><span class="kw">out</span><span class="op">.</span>println<span class="op">(</span>\<span class="st">", Last: </span><span class="sc">\"</span><span class="st"> + last);</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">//STEP 6: Clean-up environment</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      rs<span class="op">.</span>close<span class="op">();</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      stmt<span class="op">.</span>close<span class="op">();</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      conn<span class="op">.</span>close<span class="op">();</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span>SQLException se<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">....</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Not very convenient right? Personally I think this looks horrible, it’s filled with horrible getters &amp; setters like we’re stuck in the Middle Ages or something. Personally my mind directly flows to serialization and how that must work somehow with databases, and that’s right - we can move into the future today!</p>
</section>
<section id="moving-one-abstraction-level-up" class="level3">
<h3 class="anchored" data-anchor-id="moving-one-abstraction-level-up">Moving one abstraction level up</h3>
<p>Welcome <a href="https://developer.android.com/topic/libraries/architecture/room">Room</a> &amp; <a href="http://scala-slick.org/">slick</a> (two libraries I’ve experience with) to the room! Both of these libraries provide a type of serialization to classes and more convenient syntax to write the code. The first one heavily leans on annotation to make it work while the other one uses a more slick approach of "copying" the way you work with the standard Scala Collections (<code>filter, map, flatMap, reduce</code> etc).</p>
<p>I’d say that both do count as ORMs but they’re still not as abstract as other solutions such as <em>peewee</em> which we’ll discuss later. Let’s get into Room and how it works. First you define entities like a class with the added annotation <code>@Entity</code> and then you define a <em>Data Access Object</em> (DAO) to interact with the table / object. The DAO is where you define your queries, let’s take a look.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode kotlin code-with-copy"><code class="sourceCode kotlin"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Dao</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> UserDao <span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Query</span><span class="op">(</span>\<span class="st">"SELECT * FROM user</span><span class="sc">\"</span><span class="st">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">getAll</span><span class="op">():</span> <span class="dt">List</span><span class="op">&lt;</span><span class="dt">User</span><span class="op">&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    @<span class="fu">Query</span><span class="op">(</span>\"<span class="va">SELECT</span> * <span class="va">FROM</span> <span class="va">user</span> <span class="va">WHERE</span> <span class="va">uid</span> <span class="va">IN</span> (<span class="op">:</span><span class="dt">userIds</span><span class="op">)</span>\")</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">loadAllByIds</span><span class="op">(</span><span class="va">userIds</span><span class="op">:</span> <span class="dt">IntArray</span><span class="op">):</span> <span class="dt">List</span><span class="op">&lt;</span><span class="dt">User</span><span class="op">&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In my opinion this approach strikes a really good balance between simple-to-use but still powerful and very configurable because you still use SQL, a bonus here is that it’s safe from SQL-injection as you’re making use of so-called <code>prepared-statements</code> (<a href="https://en.wikipedia.org/wiki/Prepared_statement">wikipedia</a>). The biggest drawback is that it’s hard to write easy-to-read SQL in the annotation and for the annotation-haters we’ve a lot of annotations (which often slows down the compile-time noticeably among other things).</p>
<p>Moving on we’ve <code>slick</code> which is also a really cool approach! <code>slick</code> allows you to this but instead you write your queries in something that feels like using the normal Scala Collection library. This allows you to use <code>map</code>, <code>filter</code>, <code>reduce</code> etc to create queries, and even <code>for-comprehension</code>. Let’s see!</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Read all coffees and print them to the console</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span>\<span class="st">"Coffees:</span><span class="ch">\"</span><span class="st">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">run</span><span class="op">(</span>coffees<span class="op">.</span>result<span class="op">).</span><span class="fu">map</span><span class="op">(</span>_<span class="op">.</span>foreach <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="op">(</span>name<span class="op">,</span> supID<span class="op">,</span> price<span class="op">,</span> sales<span class="op">,</span> total<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span><span class="op">(</span>\<span class="st">"  </span><span class="ch">\"</span><span class="st"> + name + </span><span class="ch">\"\\</span><span class="st">t</span><span class="ch">\"</span><span class="st"> + supID + </span><span class="ch">\"\\</span><span class="st">t</span><span class="ch">\"</span><span class="st"> + price + </span><span class="ch">\"\\</span><span class="st">t</span><span class="ch">\"</span><span class="st"> + sales + </span><span class="ch">\"\\</span><span class="st">t</span><span class="ch">\"</span><span class="st"> + total)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Read coffee with price lower than 9 and join with matching supplier using for-comprehension</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> q2 <span class="op">=</span> <span class="cf">for</span> <span class="op">{</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  c <span class="op">&lt;-</span> coffees <span class="cf">if</span> c<span class="op">.</span>price <span class="op">&lt;</span> <span class="fl">9.0</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  s <span class="op">&lt;-</span> suppliers <span class="cf">if</span> s<span class="op">.</span>id <span class="op">===</span> c<span class="op">.</span>supID</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">yield</span> <span class="op">(</span>c<span class="op">.</span>name<span class="op">,</span> s<span class="op">.</span>name<span class="op">)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">// A find using filter</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">find</span><span class="op">(</span>id<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span> <span class="op">=</span> db<span class="op">.</span><span class="fu">run</span><span class="op">(</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  users</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span><span class="op">(</span>_<span class="op">.</span>id <span class="op">===</span> id<span class="op">)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>result<span class="op">.</span>headOption</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pretty slick right?</p>
</section>
<section id="moving-another-level-up-python-peewee" class="level3">
<h3 class="anchored" data-anchor-id="moving-another-level-up-python-peewee">Moving another level up (Python + Peewee)</h3>
<p>Ok, maybe it’s not actually moving one level up from <code>slick</code> but I’d say it’s still a little bit further away from raw SQL as we make more use of objects, in the case of <code>slick</code> you can more easily see the generated SQL-code. Let’s take a look at <a href="http://docs.peewee-orm.com/en/latest/index.html">peewee</a> which supports most databases (sqlite, mysql, postgresql and cockroachdb).</p>
<p>So where do we begin? Create the database and tables! It’s done by initiating a database and then creating different classes which each maps to their own tables automatically.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode kotlin code-with-copy"><code class="sourceCode kotlin"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> SqliteDatabase<span class="op">(</span><span class="er">'</span>people<span class="op">.</span>db<span class="er">'</span><span class="op">)</span> # create the db</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person<span class="op">(</span><span class="va">Model</span><span class="op">):</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span> = <span class="dt">CharField</span><span class="op">()</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">birthday</span> = <span class="dt">DateField</span><span class="op">()</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Meta<span class="op">:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">database</span> = <span class="dt">db</span> # <span class="dt">This</span> <span class="dt">model</span> <span class="dt">uses</span> <span class="dt">the</span> \"<span class="dt">people</span>.<span class="dt">db</span>\" <span class="dt">database</span>.</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Pet<span class="op">(</span><span class="va">Model</span><span class="op">):</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">owner</span> = <span class="dt">ForeignKeyField</span><span class="op">(</span><span class="va">Person</span><span class="op">,</span> <span class="va">backref</span><span class="op">=</span><span class="er">'</span>pets<span class="er">'</span><span class="op">)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span> = <span class="dt">CharField</span><span class="op">()</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">animal_type</span> = <span class="dt">CharField</span><span class="op">()</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Meta<span class="op">:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">database</span> = <span class="dt">db</span> # <span class="dt">this</span> <span class="dt">model</span> <span class="dt">uses</span> <span class="dt">the</span> \"<span class="dt">people</span>.<span class="dt">db</span>\" <span class="dt">database</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And how would one create entries and then query them? It’s simply done through object creation as in the following examples.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>uncle_bob <span class="op">=</span> Person(name<span class="op">=</span><span class="st">'Bob'</span>, birthday<span class="op">=</span>date(<span class="dv">1960</span>, <span class="dv">1</span>, <span class="dv">15</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>uncle_bob.save()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Sometimes the class already has a \"create method\" as in</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Person.create(name<span class="op">=</span><span class="st">'Sarah'</span>, birthday<span class="op">=</span>date(<span class="dv">1980</span>, <span class="dv">10</span>, <span class="dv">20</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># And create a pet which belongs to uncle_bob</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>bob_dog <span class="op">=</span> Pet.create(owner<span class="op">=</span>uncle_bob, name<span class="op">=</span><span class="st">'Doggy'</span>, animal_type<span class="op">=</span><span class="st">'dog'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And to query the tables we also make use of the object fully, as in the following small example.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bobby <span class="op">=</span> Person.select().where(Person.name <span class="op">==</span> <span class="st">'Bob'</span>).get()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or all persons!</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> person <span class="kw">in</span> Person.select():</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(person.name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we’ve gone through the different abstraction layers that you usually see available in most languages. Going forward I’d like to show SQLDelight which turns the abstraction a little bit upside down.</p>
</section>
<section id="sqldelight-abstraction-level-left-to-the-right" class="level3">
<h3 class="anchored" data-anchor-id="sqldelight-abstraction-level-left-to-the-right">SQLDelight: Abstraction level left to the right</h3>
<p>In SQLDelight I’d say we get the ideal balance of abstraction and configurability. We deal with raw SQL which is both a pro &amp; con, people will need to know SQL unlike in a abstracted ORM but you also get the full potential and it’s really simple to do complex joins (which is really messy in ORMs).</p>
<p>I was delighted at how simple it was to use from my Kotlin code while also providing a simple way to write my DB-interactions. No confusion and there’s a million guides out there showing how you write SQL code for complex joins if you ever need a hand.</p>
<p>Let’s begin with how you define a table and queries, through a so-called <code>.sq</code>-file.</p>
<pre class="sqlite"><code>-- .sq-file

CREATE TABLE person (
  name TEXT NOT NULL,
  birthday DATE NOT NULL
);
-- You can actually also insert a Person directly in this file if you'd like using the normal SQL insert statement.

selectAll:
SELECT *
FROM person;

insert:
INSERT INTO person(name, birthday)
VALUES (?, ?);

insertPerson:
INSERT INTO person(name, birthday)
VALUES ?;</code></pre>
<p>For those that don’t know SQL this does the following</p>
<ol type="1">
<li>Define the table</li>
<li>Create queries on the table
<ol type="1">
<li>These queries makes use of the custom format <code>methodName:</code> and then define the method using the SQL code beneath until it hits end <code>;</code>.</li>
</ol></li>
</ol>
<p>Now we have some SQL code defined in a <code>.sq</code>-file, how do we actually use this from our Kotlin-code? We build the project, while building the project the code is generated to our build project with the Kotlin-code. It’ll provide</p>
<ul>
<li>Data Classes (like structs / objects / case classes)</li>
<li>Queries for each table</li>
</ul>
<p>And on top of this you’ll have <em>full</em> typing, which is pretty damn awesome! Let’s take a look at how we’d use this from Kotlin.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode kotlin code-with-copy"><code class="sourceCode kotlin"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Not optimal code, should use injection or something in reality for the db.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> <span class="va">database</span> <span class="op">=</span> Database<span class="op">(</span>driver<span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> <span class="va">personQueries</span><span class="op">:</span> PersonQueries <span class="op">=</span> database<span class="op">.</span>personQueries</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>println<span class="op">(</span>personQueries<span class="op">.</span>selectAll<span class="op">().</span>executeAsList<span class="op">())</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Prints []</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>personQueries<span class="op">.</span>insert<span class="op">(</span>name <span class="op">=</span> \<span class="st">"Bob</span><span class="sc">\"</span><span class="st">, birthday = Date(2010, 1, 10))</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>println<span class="op">(</span>personQueries<span class="op">.</span>selectAll<span class="op">().</span>executeAsList<span class="op">())</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Prints [Person.Impl(\"Bob\", Date(2010, 1, 10))]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> <span class="va">person</span> <span class="op">=</span> Person<span class="op">(</span>\<span class="st">"Ronald McDonald</span><span class="sc">\"</span><span class="st">, Date(2020, 1, 5))</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>personQueries<span class="op">.</span>insertPerson<span class="op">(</span>person<span class="op">)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>println<span class="op">(</span>personQueries<span class="op">.</span>selectAll<span class="op">().</span>executeAsList<span class="op">())</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Prints [Person.Impl(\"Bob\", Date(2010, 1, 10)), Person.Impl(\"Ronald McDonald\", Date(2020, 1, 5))]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let me just say, I’m amazed about this kind of reverse thinking of generating code from SQL. It gives us the convenience of a ORM but the flexibility of raw SQL :happy:.</p>
</section>
<section id="comparison-table" class="level3">
<h3 class="anchored" data-anchor-id="comparison-table">Comparison Table</h3>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Database</th>
<th>Simplicity</th>
<th>Requires SQL knowledge</th>
<th>Configurability (complex queries etc)</th>
<th>Score (5)</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>JDBC</td>
<td>I</td>
<td>III</td>
<td>III</td>
<td>2</td>
<td>To much overhead</td>
</tr>
<tr class="even">
<td>Room / Slick</td>
<td>II</td>
<td>II</td>
<td>II</td>
<td>4</td>
<td>Strikes a good balance between natural in normal code while configurable*</td>
</tr>
<tr class="odd">
<td>Peewee</td>
<td>III</td>
<td>I</td>
<td>I</td>
<td>3</td>
<td>Really easy and fits into code great, but the complex queries becomes really hard and feels forced</td>
</tr>
<tr class="even">
<td>SQLDelight</td>
<td>II</td>
<td>III</td>
<td>III</td>
<td>5</td>
<td>Natural to use in the code, great customability &amp; little overhead*</td>
</tr>
</tbody>
</table>
<p>Both Room &amp; SQLDelight are enforcing SQLite right now which is a major con for those that needs postgresql etc. Personally I only use SQLite as was discussed in <a href="https://blog.expensify.com/2018/01/08/scaling-sqlite-to-4m-qps-on-a-single-server/">expensify’s blog</a> SQLite can be squeezed to the extreme - expensify managed to handle up to 4 million queries per second!</p>
</section>
<section id="outro" class="level3">
<h3 class="anchored" data-anchor-id="outro">Outro</h3>
<p>In its essence today there’s a great variety of different kinds of wrappers for databases in almost all languages and it is all about finding one that strikes your balance of perfect. For a really simple database perhaps an ORM such as <em>peewee</em> where no SQL knowledge is really required could be enough. But be sure to know the trade-offs, once your database grows complex so does peewee grow complex fast, same applies to slick and others. Raw SQL as a fall-back is always good to have and a lot of the libraries are starting to add it (e.g.&nbsp;slick), but it never feels natural and always is a bit like a bandaid, ugly right?</p>
<p>Anyhow, I hope this was interesting and perhaps someone learned about a new abstraction-level for databases or was inspired to pick up their own.</p>
<p>~Hampus</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="londogard/londogard" data-repo-id="MDEwOlJlcG9zaXRvcnkyOTcyNzE0MzE=" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMwODYxNzM4" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.buymeacoffee.com/hlondogard"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" class="img-fluid" width="100"></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/sponsors/Lundez?o=esb"><img src="https://img.shields.io/static/v1?label=Sponsor&amp;message=%E2%9D%A4&amp;logo=GitHub&amp;color=%23fe8e86.png" class="img-fluid" width="100"></a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../pages/about.html">About</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hampus-londögård/">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hlondogard">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lundez">
      <i class="bi bi-github" role="img" aria-label="Lundez GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../index.xml">
      <i class="bi bi-rss" role="img" aria-label="Londogard Blog RSS">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>