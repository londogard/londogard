<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Londogard Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Londogard Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-react-helmet="true">TIL: fastutil - fast &amp; compact type-speciic collections for JVM (no autobox!) | Londogard Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.londogard.com/blog/2020/09/03/til-fastutil-primitive-structures"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="nlp, kotlin, jvm, deep-learning, machine-learning, blog"><meta data-react-helmet="true" property="og:title" content="TIL: fastutil - fast &amp; compact type-speciic collections for JVM (no autobox!) | Londogard Blog"><meta data-react-helmet="true" name="description" content="Discusses what autoboxing is, why it might hit your performance (and memory). Finally some alternatives are also provided. Learn how to use effective data collections today!"><meta data-react-helmet="true" property="og:description" content="Discusses what autoboxing is, why it might hit your performance (and memory). Finally some alternatives are also provided. Learn how to use effective data collections today!"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-09-03T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/lundez"><meta data-react-helmet="true" property="article:tag" content="jvm,TIL"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.londogard.com/blog/2020/09/03/til-fastutil-primitive-structures"><link data-react-helmet="true" rel="alternate" href="https://blog.londogard.com/blog/2020/09/03/til-fastutil-primitive-structures" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.londogard.com/blog/2020/09/03/til-fastutil-primitive-structures" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2b27dec1.css">
<link rel="preload" href="/assets/js/runtime~main.7cfbcd4f.js" as="script">
<link rel="preload" href="/assets/js/main.b98f4283.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Londogard logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/favicon.ico" alt="Londogard logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Londogard Blog</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/blog/archive">Blog Archive</a><a class="navbar__item navbar__link" href="/presentations">Presentations</a></div><div class="navbar__items navbar__items--right"><a href="https://londogard.com/about" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://londogard.com/projects" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Londogard Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/londogard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/timeseries-pt-3">[CA]: Time Series #3 - Forecasting Cryptocurrency Prices (Time Series) using Deep Learning (PyTorch, Tensorflow/Keras &amp; darts)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/timeseries-pt-2">[CA]: Time Series #2 - Predicting Stock Prices (Time Series) using classical machine Learning</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/timeseries-pt-1">[CA]: Time Series #1 - Decomposing &amp; Working with Time Series</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kotlinjs-onnx-deep-learning-browser">KotlinJS, ONNX and Deep Learning in the browser</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/2022/01/16/nlp-toolkit-release">Release nlp (londogard-nlp-toolkit) 1.1.0</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">TIL: fastutil - fast &amp; compact type-speciic collections for JVM (no autobox!)</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-09-03T00:00:00.000Z" itemprop="datePublished">September 3, 2020</time> Â· <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/lundez" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://github.com/lundez.png" alt="Hampus LondÃ¶gÃ¥rd"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lundez" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Hampus LondÃ¶gÃ¥rd</span></a></div><small class="avatar__subtitle" itemprop="description">Main Contributor of Londogard</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><blockquote><p>fastutilÂ extends theÂ Javaâ„¢ Collections FrameworkÂ by providing type-specific maps, sets, lists and queues with a small memory footprint and fast access and insertion</p></blockquote><p><a href="http://fastutil.di.unimi.it/" target="_blank" rel="noopener noreferrer">Homepage</a> of fastutil</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="what">What<a class="hash-link" href="#what" title="Direct link to heading">â€‹</a></h3><p>So what does the quote above actually mean?<br>
<!-- -->First we need to dive into, what is a Java Collection, and why are they \&quot;bad\&quot; for performance and memory requirements?</p><p>Java Collections (<code>Collection&lt;E&gt;</code>) only works with objects, meaning that if we have a <code>List&lt;E&gt;</code> which we populate with <code>int</code> it&#x27;ll actually \&quot;autobox\&quot; the <code>int</code> into a <code>Integer</code>, i.e. the class, rather than the primitive type.<br>
<!-- -->What does this mean for you as a user?</p><ul><li>It&#x27;s done through \&quot;autoboxing\&quot; which means automatic casting to the <code>Integer</code>-type, so nothing required for you</li><li>It allocates more memory than the primitive <code>int</code>.</li></ul><p>So how do you create an effective <code>List</code> that contains primitives, such as <code>int, boolean</code> and <code>float</code>? You can&#x27;t.<br>
<!-- -->What you can do is to create an array, <code>int[]</code>, which will contain the actual primitives, no autoboxing applied.</p><p>But what if you want to have the methods from <code>List</code>, such as <code>find</code> and \&quot;auto-resizing\&quot;?
Then you&#x27;ll have to research and find a library, <code>fastutil</code> to the rescue!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="how">How<a class="hash-link" href="#how" title="Direct link to heading">â€‹</a></h3><p><code>fastutil</code> implements their own versions of <code>List</code>, <code>HashMap</code> and so on which actually use the raw primitives, thereby increasing throughput while lowering memory used (as we&#x27;re not allocating as many objects anymore, when using primitives).</p><p><em>These types of libraries are only required once you hit an enormous amount of data or very strict requirement.</em></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">â€‹</a></h4><p>Using gradle</p><p><code>implementation: &#x27;it.unimi.dsi:fastutil:8.4.1&#x27;</code> (latest version as of Aug 2020, <a href="https://mvnrepository.com/artifact/it.unimi.dsi/fastutil" target="_blank" rel="noopener noreferrer">mvnrepository</a>)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">â€‹</a></h4><p><em>DoubleToDoubleMap</em></p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">val d2dMap: Double2DoubleMap = Double2DoubleOpenHashMap().apply {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    put(2.0, 5.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    put(3.0, 6.6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assertEquals(5.5, d2dMap.get(2.0))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This map is not only less memory-hungry (because using <code>double</code> rather than <code>Double</code>) but is also faster with insertions &amp; get, than the Java Collections counterpart.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="why">Why<a class="hash-link" href="#why" title="Direct link to heading">â€‹</a></h3><p><strong>Less space used &amp; faster</strong> - it is as simple as that!</p><ul><li>No \&quot;AutoBoxing\&quot;</li><li>No Object allocations for primitives</li></ul><p><em>Side-note</em>
Something I noticed while working on my Language Model in Kotlin, with some strict requirements and a lot of data, was that even when using <code>fastutil</code> I wasn&#x27;t gaining that much as I was  mainly using <code>views</code> of my Lists, further optimizing memory. Views are what the name implies, a view of the List. It never creates a copy but just the indices and make use of the original structure.
Using immutable data this is very effective, but if you&#x27;d been using mutable data it could prove dangerous as someone can change the structure and data of your view (even if your view is immutable the underlying List might not be).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="alternatives">Alternatives<a class="hash-link" href="#alternatives" title="Direct link to heading">â€‹</a></h3><p><a href="https://www.eclipse.org/collections/" target="_blank" rel="noopener noreferrer">Goldman Sachs Collection - now Eclipse Collections</a> - Probably the best alternative, in my opinion.
<a href="http://labs.carrotsearch.com/hppc.html" target="_blank" rel="noopener noreferrer">HPPC - Carrot Search Labs</a>
<a href="https://bitbucket.org/trove4j/trove/src/master/" target="_blank" rel="noopener noreferrer">Trove4j</a> - Not as active as other alternatives, but who cares when it&#x27;s performant and \&quot;done\&quot;?</p><p>Find a 2015 benchmark of the libraries <a href="http://java-performance.info/hashmap-overview-jdk-fastutil-goldman-sachs-hppc-koloboke-trove-january-2015/" target="_blank" rel="noopener noreferrer">here</a>
At least both <code>fastutil</code>&amp; <code>Eclipse Collections</code> are updated for Java 8 streams!</p><p>-Hampus LondÃ¶gÃ¥rd</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/jvm">jvm</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/til">TIL</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/londogard/londogard/blog/2020-09-03-til-fastutil-primitive-structures.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/09/03/til-badass-runtime"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">TIL: &#x27;The Badass Runtime Plugin&#x27;, jpackage &amp; jlink - create a &#x27;native&#x27; installable executable from your JVM-app that isn&#x27;t huge</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/08/01/faq-search-covid-2"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">CoViD-19 FAQ Search Engine 2.0</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what" class="table-of-contents__link toc-highlight">What</a></li><li><a href="#how" class="table-of-contents__link toc-highlight">How</a></li><li><a href="#why" class="table-of-contents__link toc-highlight">Why</a></li><li><a href="#alternatives" class="table-of-contents__link toc-highlight">Alternatives</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support Londogard</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/hlondogard" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/Lundez/button" title="Sponsor Lundez" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/londogard" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.londogard.com/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/blog/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Londogard. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7cfbcd4f.js"></script>
<script src="/assets/js/main.b98f4283.js"></script>
</body>
</html>