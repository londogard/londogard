<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Gradle, JVM and GitHub Packages | Londogard</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Gradle, JVM and GitHub Packages" />
<meta name="author" content="Hampus Londögård" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A simple show-case on how to publish libraries to both GitHub Packages &amp; JitPack with a one-button release using gradle &amp; GitHub Actions." />
<meta property="og:description" content="A simple show-case on how to publish libraries to both GitHub Packages &amp; JitPack with a one-button release using gradle &amp; GitHub Actions." />
<link rel="canonical" href="https://blog.londogard.com/gradle/jvm/library/2020/02/10/gradle-github-packages.html" />
<meta property="og:url" content="https://blog.londogard.com/gradle/jvm/library/2020/02/10/gradle-github-packages.html" />
<meta property="og:site_name" content="Londogard" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-10T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"A simple show-case on how to publish libraries to both GitHub Packages &amp; JitPack with a one-button release using gradle &amp; GitHub Actions.","url":"https://blog.londogard.com/gradle/jvm/library/2020/02/10/gradle-github-packages.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.londogard.com/gradle/jvm/library/2020/02/10/gradle-github-packages.html"},"headline":"Gradle, JVM and GitHub Packages","dateModified":"2020-02-10T00:00:00-06:00","datePublished":"2020-02-10T00:00:00-06:00","author":{"@type":"Person","name":"Hampus Londögård"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.londogard.com/feed.xml" title="Londogard" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Londogard</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/Londogard">Londogard</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Gradle, JVM and GitHub Packages</h1><p class="page-description">A simple show-case on how to publish libraries to both _GitHub Packages_ & _JitPack_ with a one-button release using gradle & GitHub Actions.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-02-10T00:00:00-06:00" itemprop="datePublished">
        Feb 10, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Hampus Londögård</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#gradle">gradle</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#jvm">jvm</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#library">library</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#gradle-jvm-and-github-packages">Gradle, JVM and GitHub Packages</a>
<ul>
<li class="toc-entry toc-h2"><a href="#1-add-maven-publish-plugin">1. Add Maven Publish Plugin</a></li>
<li class="toc-entry toc-h2"><a href="#2-add-publication-part">2. Add Publication Part</a></li>
<li class="toc-entry toc-h2"><a href="#3-automating-release-workflow">3. Automating Release Workflow</a></li>
</ul>
</li>
</ul><h1 id="gradle-jvm-and-github-packages">
<a class="anchor" href="#gradle-jvm-and-github-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gradle, JVM and GitHub Packages</h1>

<p><em>Initial comment</em> this is mainly done as a reminder to myself.</p>

<p>So about 6 months ago GitHub launched a new exciting service; <a href="https://github.blog/2019-05-10-introducing-github-package-registry/">GitHub Package Registry</a>. This service lets you as a GitHub-user upload your Open Source code for free on GitHubs registry supporting a wide array of languagues and build systems - JavaScript (npm), Java/JVM-languages (Maven/Gradle), Ruby (RubyGems), .NET (NuGet), and Docker images. Perhaps more have been added since I last verified.</p>

<p>In this post I’ll try to keep to the point and give clear easy instruction that you’ll be able to bookmark and go back to whenever you need to set this up.</p>

<p>I’ll give the instruction directly beneath with some comments afterwards for the one who’d like to read some extra.</p>

<hr>

<h2 id="1-add-maven-publish-plugin">
<a class="anchor" href="#1-add-maven-publish-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Add Maven Publish Plugin</h2>

<p><code class="language-plaintext highlighter-rouge">build.gradle.kts</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plugins</span> <span class="p">{</span>
    <span class="n">`maven-publish`</span> <span class="c1">// Add this</span>
    <span class="nf">kotlin</span><span class="p">(</span><span class="err">\</span><span class="s">"jvm\") version \"1.3.60\"
</span><span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">build.gradle</code></p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span><span class="o">(</span><span class="err">\</span><span class="s2">"maven-publish\"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">build.gradle</code> (using the <em>old</em> <code class="language-plaintext highlighter-rouge">apply</code> way of things)</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven-publish'</span>
</code></pre></div></div>

<h2 id="2-add-publication-part">
<a class="anchor" href="#2-add-publication-part" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Add Publication Part</h2>

<p><code class="language-plaintext highlighter-rouge">build.gradle.kts</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">publishing</span> <span class="p">{</span>
    <span class="nf">repositories</span> <span class="p">{</span>
        <span class="nf">maven</span> <span class="p">{</span>
            <span class="n">name</span> <span class="p">=</span> <span class="err">\</span><span class="s">"GitHubPackages\"
</span>            <span class="n">url</span> <span class="p">=</span> <span class="nf">uri</span><span class="p">(</span><span class="err">\</span><span class="s">"https://maven.pkg.github.com/OWNER/REPO\")
</span>            <span class="nf">credentials</span> <span class="p">{</span>
                <span class="n">username</span> <span class="p">=</span> <span class="n">project</span><span class="p">.</span><span class="nf">findProperty</span><span class="p">(</span><span class="err">\</span><span class="s">"gpr.user\") as String? ?: System.getenv(\"GITHUB_ACTOR\")
</span>                <span class="n">password</span> <span class="p">=</span> <span class="n">project</span><span class="p">.</span><span class="nf">findProperty</span><span class="p">(</span><span class="err">\</span><span class="s">"gpr.key\") as String? ?: System.getenv(\"GITHUB_TOKEN\")
</span>            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">publications</span> <span class="p">{</span>
        <span class="n">register</span><span class="p">&lt;</span><span class="nc">MavenPublication</span><span class="p">&gt;(</span><span class="err">\</span><span class="s">"gpr\"){
</span>            <span class="nf">from</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="err">\</span><span class="s">"java\"])
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">build.gradle</code></p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">publishing</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">maven</span> <span class="o">{</span>
            <span class="n">name</span> <span class="o">=</span> <span class="err">\</span><span class="s2">"GitHubPackages\"</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">uri</span><span class="o">(</span><span class="err">\</span><span class="s2">"https://maven.pkg.github.com/OWNER/REPOSITORY\"</span><span class="o">)</span>
            <span class="n">credentials</span> <span class="o">{</span>
                <span class="n">username</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">findProperty</span><span class="o">(</span><span class="err">\</span><span class="s2">"gpr.user\") ?: System.getenv(\"GITHUB_ACTOR\"</span><span class="o">)</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">findProperty</span><span class="o">(</span><span class="err">\</span><span class="s2">"gpr.key\") ?: System.getenv(\"GITHUB_TOKEN\"</span><span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">publications</span> <span class="o">{</span>
        <span class="n">gpr</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">from</span><span class="o">(</span><span class="n">components</span><span class="o">.</span><span class="na">java</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="3-automating-release-workflow">
<a class="anchor" href="#3-automating-release-workflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Automating Release Workflow</h2>

<p>To simplify our lifes further;</p>

<ul>
  <li>JitPack is already automated and tracking your repository automatically adding the new releases ones a release is created.</li>
  <li>GitHub is <em>not</em> automated and we need to upload our assets</li>
</ul>

<p><strong>Automating GitHub packages upload through release &amp; GitHub Actions</strong></p>

<p>We’ll use GitHub Actions to create a workflow where once a release passes stage ‘published’ the assets will be uploaded to the repository/artifactory of GitHub Packages.
This integration is really awesome as once we’ve set it up we only need to press "Create Release" on the GitHub page to deploy our library to both GitHub Packages &amp; JitPack!</p>

<p>Create the directory <code class="language-plaintext highlighter-rouge">.github/workflows</code> in your root-folder of the project if it doesn’t exist yet. Add the following file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Release &amp; Publish Build</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">release</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">published</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up JDK </span><span class="m">1.8</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-java@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">java-version</span><span class="pi">:</span> <span class="m">1.8</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clean Build</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew clean build</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish Build</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew publish</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">secrets.GITHUB_TOKEN</code> is automatically supplied by GitHub itself during the run of the GitHub Actions-script.</p>

<p>Pretty awesome right? Go build your libraries and deploy!</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="londogard/londogard"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/gradle/jvm/library/2020/02/10/gradle-github-packages.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog with a focus on Deep Learning, JVM and Performance.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/londogard" title="londogard"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
