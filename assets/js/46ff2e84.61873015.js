"use strict";(self.webpackChunklondogard=self.webpackChunklondogard||[]).push([[6964],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(a),h=i,d=m["".concat(s,".").concat(h)]||m[h]||c[h]||o;return a?n.createElement(d,r(r({ref:t},u),{},{components:a})):n.createElement(d,r({ref:t},u))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6013:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},assets:function(){return u},toc:function(){return c},default:function(){return h}});var n=a(7462),i=a(3366),o=(a(7294),a(3905)),r=["components"],l={description:"Discusses what autoboxing is, why it might hit your performance (and memory). Finally some alternatives are also provided. Learn how to use effective data collections today!",tags:["jvm","TIL"],title:"TIL: fastutil - fast & compact type-speciic collections for JVM (no autobox!)",authors:"hlondogard"},s="fastutil - how to optimize your collections by primitives",p={permalink:"/blog/2020/09/03/til-fastutil-primitive-structures",editUrl:"https://github.com/londogard/londogard/blog/2020-09-03-til-fastutil-primitive-structures.md",source:"@site/blog/2020-09-03-til-fastutil-primitive-structures.md",title:"TIL: fastutil - fast & compact type-speciic collections for JVM (no autobox!)",description:"Discusses what autoboxing is, why it might hit your performance (and memory). Finally some alternatives are also provided. Learn how to use effective data collections today!",date:"2020-09-03T00:00:00.000Z",formattedDate:"September 3, 2020",tags:[{label:"jvm",permalink:"/blog/tags/jvm"},{label:"TIL",permalink:"/blog/tags/til"}],readingTime:2.51,truncated:!0,authors:[{name:"Hampus Lond\xf6g\xe5rd",title:"Main Contributor of Londogard",url:"https://github.com/lundez",imageURL:"https://github.com/lundez.png",key:"hlondogard"}],frontMatter:{description:"Discusses what autoboxing is, why it might hit your performance (and memory). Finally some alternatives are also provided. Learn how to use effective data collections today!",tags:["jvm","TIL"],title:"TIL: fastutil - fast & compact type-speciic collections for JVM (no autobox!)",authors:"hlondogard"},prevItem:{title:"TIL: 'The Badass Runtime Plugin', jpackage & jlink - create a 'native' installable executable from your JVM-app that isn't huge",permalink:"/blog/2020/09/03/til-badass-runtime"},nextItem:{title:"CoViD-19 FAQ Search Engine 2.0",permalink:"/blog/2020/08/01/faq-search-covid-2"}},u={authorsImageUrls:[void 0]},c=[{value:"What",id:"what",children:[],level:3},{value:"How",id:"how",children:[{value:"Installation",id:"installation",children:[],level:4},{value:"Usage",id:"usage",children:[],level:4}],level:3},{value:"Why",id:"why",children:[],level:3},{value:"Alternatives",id:"alternatives",children:[],level:3}],m={toc:c};function h(e){var t=e.components,a=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"fastutil\xa0extends the\xa0Java\u2122 Collections Framework\xa0by providing type-specific maps, sets, lists and queues with a small memory footprint and fast access and insertion")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"http://fastutil.di.unimi.it/"},"Homepage")," of fastutil"),(0,o.kt)("h3",{id:"what"},"What"),(0,o.kt)("p",null,"So what does the quote above actually mean?",(0,o.kt)("br",{parentName:"p"}),"\n",'First we need to dive into, what is a Java Collection, and why are they \\"bad\\" for performance and memory requirements?'),(0,o.kt)("p",null,"Java Collections (",(0,o.kt)("inlineCode",{parentName:"p"},"Collection<E>"),") only works with objects, meaning that if we have a ",(0,o.kt)("inlineCode",{parentName:"p"},"List<E>")," which we populate with ",(0,o.kt)("inlineCode",{parentName:"p"},"int"),' it\'ll actually \\"autobox\\" the ',(0,o.kt)("inlineCode",{parentName:"p"},"int")," into a ",(0,o.kt)("inlineCode",{parentName:"p"},"Integer"),", i.e. the class, rather than the primitive type.",(0,o.kt)("br",{parentName:"p"}),"\n","What does this mean for you as a user?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'It\'s done through \\"autoboxing\\" which means automatic casting to the ',(0,o.kt)("inlineCode",{parentName:"li"},"Integer"),"-type, so nothing required for you"),(0,o.kt)("li",{parentName:"ul"},"It allocates more memory than the primitive ",(0,o.kt)("inlineCode",{parentName:"li"},"int"),".")),(0,o.kt)("p",null,"So how do you create an effective ",(0,o.kt)("inlineCode",{parentName:"p"},"List")," that contains primitives, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"int, boolean")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"float"),"? You can't.",(0,o.kt)("br",{parentName:"p"}),"\n","What you can do is to create an array, ",(0,o.kt)("inlineCode",{parentName:"p"},"int[]"),", which will contain the actual primitives, no autoboxing applied."),(0,o.kt)("p",null,"But what if you want to have the methods from ",(0,o.kt)("inlineCode",{parentName:"p"},"List"),", such as ",(0,o.kt)("inlineCode",{parentName:"p"},"find"),' and \\"auto-resizing\\"?\nThen you\'ll have to research and find a library, ',(0,o.kt)("inlineCode",{parentName:"p"},"fastutil")," to the rescue!"),(0,o.kt)("h3",{id:"how"},"How"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"fastutil")," implements their own versions of ",(0,o.kt)("inlineCode",{parentName:"p"},"List"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"HashMap")," and so on which actually use the raw primitives, thereby increasing throughput while lowering memory used (as we're not allocating as many objects anymore, when using primitives)."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"These types of libraries are only required once you hit an enormous amount of data or very strict requirement.")),(0,o.kt)("h4",{id:"installation"},"Installation"),(0,o.kt)("p",null,"Using gradle"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"implementation: 'it.unimi.dsi:fastutil:8.4.1'")," (latest version as of Aug 2020, ",(0,o.kt)("a",{parentName:"p",href:"https://mvnrepository.com/artifact/it.unimi.dsi/fastutil"},"mvnrepository"),")"),(0,o.kt)("h4",{id:"usage"},"Usage"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"DoubleToDoubleMap")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"val d2dMap: Double2DoubleMap = Double2DoubleOpenHashMap().apply {\n    put(2.0, 5.5)\n    put(3.0, 6.6)\n}\nassertEquals(5.5, d2dMap.get(2.0))\n")),(0,o.kt)("p",null,"This map is not only less memory-hungry (because using ",(0,o.kt)("inlineCode",{parentName:"p"},"double")," rather than ",(0,o.kt)("inlineCode",{parentName:"p"},"Double"),") but is also faster with insertions & get, than the Java Collections counterpart."),(0,o.kt)("h3",{id:"why"},"Why"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Less space used & faster")," - it is as simple as that!"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'No \\"AutoBoxing\\"'),(0,o.kt)("li",{parentName:"ul"},"No Object allocations for primitives")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Side-note"),"\nSomething I noticed while working on my Language Model in Kotlin, with some strict requirements and a lot of data, was that even when using ",(0,o.kt)("inlineCode",{parentName:"p"},"fastutil")," I wasn't gaining that much as I was  mainly using ",(0,o.kt)("inlineCode",{parentName:"p"},"views")," of my Lists, further optimizing memory. Views are what the name implies, a view of the List. It never creates a copy but just the indices and make use of the original structure.\nUsing immutable data this is very effective, but if you'd been using mutable data it could prove dangerous as someone can change the structure and data of your view (even if your view is immutable the underlying List might not be)."),(0,o.kt)("h3",{id:"alternatives"},"Alternatives"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.eclipse.org/collections/"},"Goldman Sachs Collection - now Eclipse Collections")," - Probably the best alternative, in my opinion.\n",(0,o.kt)("a",{parentName:"p",href:"http://labs.carrotsearch.com/hppc.html"},"HPPC - Carrot Search Labs"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://bitbucket.org/trove4j/trove/src/master/"},"Trove4j"),' - Not as active as other alternatives, but who cares when it\'s performant and \\"done\\"?'),(0,o.kt)("p",null,"Find a 2015 benchmark of the libraries ",(0,o.kt)("a",{parentName:"p",href:"http://java-performance.info/hashmap-overview-jdk-fastutil-goldman-sachs-hppc-koloboke-trove-january-2015/"},"here"),"\nAt least both ",(0,o.kt)("inlineCode",{parentName:"p"},"fastutil"),"& ",(0,o.kt)("inlineCode",{parentName:"p"},"Eclipse Collections")," are updated for Java 8 streams!"),(0,o.kt)("p",null,"-Hampus Lond\xf6g\xe5rd"))}h.isMDXComponent=!0}}]);