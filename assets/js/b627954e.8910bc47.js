"use strict";(self.webpackChunklondogard=self.webpackChunklondogard||[]).push([[5315],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return h}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),d=l(a),h=i,u=d["".concat(p,".").concat(h)]||d[h]||c[h]||r;return a?n.createElement(u,o(o({ref:t},m),{},{components:a})):n.createElement(u,o({ref:t},m))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},4469:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return l},assets:function(){return m},toc:function(){return c},default:function(){return h}});var n=a(7462),i=a(3366),r=(a(7294),a(3905)),o=["components"],s={title:"Probabilistic Forecasting Made Simple",description:"While researching probabilistic forecasting in a client project I managed to find a paper which opens the door to\xa0**any**\xa0neural network\xa0_with dropout_\xa0- which is the majority. That is, we can do probabilistic forecasting with essentially any network!",slug:"probabilistic-forecasting",tags:["machine-learning","timeseries"],authors:"hlondogard"},p=void 0,l={permalink:"/blog/probabilistic-forecasting",editUrl:"https://github.com/londogard/londogard/blog/2022-11-28-probabilistic-forecasting/index.md",source:"@site/blog/2022-11-28-probabilistic-forecasting/index.md",title:"Probabilistic Forecasting Made Simple",description:"While researching probabilistic forecasting in a client project I managed to find a paper which opens the door to\xa0**any**\xa0neural network\xa0_with dropout_\xa0- which is the majority. That is, we can do probabilistic forecasting with essentially any network!",date:"2022-11-28T00:00:00.000Z",formattedDate:"November 28, 2022",tags:[{label:"machine-learning",permalink:"/blog/tags/machine-learning"},{label:"timeseries",permalink:"/blog/tags/timeseries"}],readingTime:3.105,truncated:!0,authors:[{name:"Hampus Lond\xf6g\xe5rd",title:"Main Contributor of Londogard",url:"https://github.com/lundez",imageURL:"https://github.com/lundez.png",key:"hlondogard"}],frontMatter:{title:"Probabilistic Forecasting Made Simple",description:"While researching probabilistic forecasting in a client project I managed to find a paper which opens the door to\xa0**any**\xa0neural network\xa0_with dropout_\xa0- which is the majority. That is, we can do probabilistic forecasting with essentially any network!",slug:"probabilistic-forecasting",tags:["machine-learning","timeseries"],authors:"hlondogard"},prevItem:{title:"Polars - A Refreshingly Great DataFrame Library",permalink:"/blog/2022/11/30/why-polars"},nextItem:{title:"Timeseries Learnings at AFRY",permalink:"/blog/timeseries-learnings"}},m={authorsImageUrls:[void 0]},c=[{value:"Probabilistic Forecasting Made Simple",id:"probabilistic-forecasting-made-simple",children:[],level:2},{value:"How to do probabilistic forecasting on any deep learning model",id:"how-to-do-probabilistic-forecasting-on-any-deep-learning-model",children:[],level:2},{value:"The possibilities",id:"the-possibilities",children:[{value:"1. Model Understanding (Weakness/Strength)",id:"1-model-understanding-weaknessstrength",children:[],level:4},{value:"2. Downstream Consumer Happiness",id:"2-downstream-consumer-happiness",children:[],level:4}],level:2},{value:"Sources",id:"sources",children:[],level:2}],d={toc:c};function h(e){var t=e.components,s=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"probabilistic-forecasting-made-simple"},"Probabilistic Forecasting Made Simple"),(0,r.kt)("p",null,"Probabilistic Forecasting is something very cool, but it is not approachable in the current state of affairs.\xa0"),(0,r.kt)("p",null,"While researching probabilistic forecasting in a client project I managed to find a paper which opens the door to ",(0,r.kt)("strong",{parentName:"p"},"any")," neural network ",(0,r.kt)("em",{parentName:"p"},"with dropout"),"\xa0- which is the majority. That is, we can do probabilistic forecasting with essentially any network!  "),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/unit8co/darts",title:"https://github.com/unit8co/darts"},"Darts"),", a brilliant timeseries library, includes a very competent probabilistic forecasting but it\u2019s not really applicable to all models. This is the reason that I started diving into the whole space of probabilistic forecasting. A probabilistic model includes not only a raw prediction value but a distribution of possible points, which ends up with a prediction like:"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(253).Z,width:"1077",height:"789"}),"  "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Probabilistic Model by ",(0,r.kt)("a",{parentName:"p",href:"https://unit8.com/resources/probabilistic-forecasting-in-darts/",title:"https://unit8.com/resources/probabilistic-forecasting-in-darts/"},"unit8/darts"),"  ")),(0,r.kt)("p",null,"Additionally models like ARIMA and ExponentialSmoothing allows to do this kind of thing very easily, simply sample running simulations of their state-spaced models with a bit of randomly sampled errors. To solve this on their deep learning models darts decided to model distribution using a ",(0,r.kt)("inlineCode",{parentName:"p"},"Likelihood"),"\xa0 class. What does this mean?",(0,r.kt)("br",{parentName:"p"}),"\n","The model does not actually predict a value but a distribution, using ",(0,r.kt)("inlineCode",{parentName:"p"},"Gaussian"),"\xa0 we\u2019d predict two values - ",(0,r.kt)("inlineCode",{parentName:"p"},"mean"),"\xa0 and ",(0,r.kt)("inlineCode",{parentName:"p"},"std"),"\xa0.  "),(0,r.kt)("h2",{id:"how-to-do-probabilistic-forecasting-on-any-deep-learning-model"},"How to do probabilistic forecasting on any deep learning model"),(0,r.kt)("p",null,"By combining the knowledge in ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://arxiv.org/pdf/1709.01907.pdf",title:"https://arxiv.org/pdf/1709.01907.pdf"},"Deep and Confident Prediction Time Series at Uber")),"\xa0by L. Zhi & N. Laptev (2017) with\xa0",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://arxiv.org/pdf/1703.04977.pdf",title:"https://arxiv.org/pdf/1703.04977.pdf"},"What Uncertainties Do We Need in Bayesian Deep Learning for Computer Vision?")),"\xa0by A. Kendall & Y. Gal (2017) one can conclude that it\u2019s possible to model distributions using dropout during inference. In the Uber paper they use a special variant they call \u201cMonte Carlo dropout\u201d, which I don\u2019t believe is required to achieve interesting results. Using the pure dropout-module which randomly zeroes some elements by a probability ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"p")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"p"))))),"\xa0 sampling from a Bernoulli Distribution."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"How do we do this?")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Activate Dropout during Inference.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Do ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"x")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"x")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"x"))))),"\xa0 predictions with a dropout probability ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"p")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"p"))))),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Based on these x\xa0predictions we have a distribution of data.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build a ",(0,r.kt)("em",{parentName:"p"},"confidence interval"),"\xa0from the points."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"  outs = torch.vstack([model.predict(in_data) for i in range(x)])\n  # Defined by confidence coefficients\n  Z_TABLE = {0.8: 1.28, 0.85: 1.44, 0.9: 1.65, 0.95: 1.96, 0.99: 2.58, 0.999: 3.29, 0.9999: 3.89}\n\n  # Confidence Interval with mean as line\n  mean = outs.mean()\n  lower = mean - Z_TABLE[confidence] * outs.std()\n  upper = mean + Z_TABLE[confidence] * outs.std()```\n")))))),(0,r.kt)("h2",{id:"the-possibilities"},"The possibilities"),(0,r.kt)("p",null,"There\u2019s a lot of possiblities, I\u2019ll share two of our biggest ones."),(0,r.kt)("h4",{id:"1-model-understanding-weaknessstrength"},"1","."," Model Understanding (Weakness/Strength)"),(0,r.kt)("p",null,"By returning a ",(0,r.kt)("em",{parentName:"p"},"probabilistic forecast"),", i.e. a distribution/confidence interval, we can learn more about the model and its strengths/weaknesses.\xa0"),(0,r.kt)("p",null,"In our project(s) we\u2019ve seen that it opens a door to really figure out how to improve our models by focusing on the areas were the model is the most uncertain. This has proved to improve performance by a substantial amount which makes the effort worth it."),(0,r.kt)("h4",{id:"2-downstream-consumer-happiness"},"2","."," Downstream Consumer Happiness"),(0,r.kt)("p",null,"We see that our clients trust the model further by being able to see how confident they are. Building trust between model and downstream consumer is really important to deliver an actual successful project, which once again makes the effort totally worth it!"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Bonus:")," we also found that it opens new possibilities to chain of the inference power if you keep it in production, as your downstream tasks can now make use of a confidence interval rather than a raw data point. But\xa0the inference is very expensive compared to the usual (remember we do x\xa0predictions per prediction)!"),(0,r.kt)("h2",{id:"sources"},"Sources"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://arxiv.org/pdf/1709.01907.pdf",title:"https://arxiv.org/pdf/1709.01907.pdf"},"Deep and Confident Prediction Time Series at Uber")),"\xa0by L. Zhi & N. Laptev (2017) -\xa0",(0,r.kt)("a",{parentName:"p",href:"https://arxiv.org/pdf/1709.01907.pdf"},"https://arxiv.org/pdf/1709.01907.pdf"),"  "),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://arxiv.org/pdf/1703.04977.pdf",title:"https://arxiv.org/pdf/1703.04977.pdf"},"What Uncertainties Do We Need in Bayesian Deep Learning for Computer Vision?")),"\xa0by A. Kendall & Y. Gal (2017) -\xa0",(0,r.kt)("a",{parentName:"p",href:"https://arxiv.org/pdf/1703.04977.pdf"},"https://arxiv.org/pdf/1703.04977.pdf")))}h.isMDXComponent=!0},253:function(e,t,a){t.Z=a.p+"assets/images/image-d18296cf9042fa153edce5ab35c7103f.png"}}]);