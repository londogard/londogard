"use strict";(self.webpackChunklondogard=self.webpackChunklondogard||[]).push([[2006],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=u(a),c=r,m=h["".concat(s,".").concat(c)]||h[c]||d[c]||i;return a?n.createElement(m,o(o({ref:t},p),{},{components:a})):n.createElement(m,o({ref:t},p))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},7096:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},assets:function(){return p},toc:function(){return d},default:function(){return c}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],l={description:"'The Badass Runtime Plugin' is a plugin that allows you to package a stripped down JRE and modules from your program into a 'native' installable program which doesn't require the user to have Java installed. It takes help of JPackage & JLink to achieve this, my own small program ended up at 35 MB including JRE, which is pretty crazy. This is like Electron, but better! ;)",tags:["jvm","TIL"],title:"TIL: 'The Badass Runtime Plugin', jpackage & jlink - create a 'native' installable executable from your JVM-app that isn't huge",authors:"hlondogard"},s="JPackage, JLink and how to pack a modern Java App",u={permalink:"/blog/2020/09/03/til-badass-runtime",editUrl:"https://github.com/londogard/londogard/blog/2020-09-03-til-badass-runtime.md",source:"@site/blog/2020-09-03-til-badass-runtime.md",title:"TIL: 'The Badass Runtime Plugin', jpackage & jlink - create a 'native' installable executable from your JVM-app that isn't huge",description:"'The Badass Runtime Plugin' is a plugin that allows you to package a stripped down JRE and modules from your program into a 'native' installable program which doesn't require the user to have Java installed. It takes help of JPackage & JLink to achieve this, my own small program ended up at 35 MB including JRE, which is pretty crazy. This is like Electron, but better! ;)",date:"2020-09-03T00:00:00.000Z",formattedDate:"September 3, 2020",tags:[{label:"jvm",permalink:"/blog/tags/jvm"},{label:"TIL",permalink:"/blog/tags/til"}],readingTime:4.505,truncated:!0,authors:[{name:"Hampus Lond\xf6g\xe5rd",title:"Main Contributor of Londogard",url:"https://github.com/lundez",imageURL:"https://github.com/lundez.png",key:"hlondogard"}],frontMatter:{description:"'The Badass Runtime Plugin' is a plugin that allows you to package a stripped down JRE and modules from your program into a 'native' installable program which doesn't require the user to have Java installed. It takes help of JPackage & JLink to achieve this, my own small program ended up at 35 MB including JRE, which is pretty crazy. This is like Electron, but better! ;)",tags:["jvm","TIL"],title:"TIL: 'The Badass Runtime Plugin', jpackage & jlink - create a 'native' installable executable from your JVM-app that isn't huge",authors:"hlondogard"},prevItem:{title:"TIL: SDKMan - The Software Development Kit Manager",permalink:"/blog/2020/09/04/til-sdkman"},nextItem:{title:"TIL: fastutil - fast & compact type-speciic collections for JVM (no autobox!)",permalink:"/blog/2020/09/03/til-fastutil-primitive-structures"}},p={authorsImageUrls:[void 0]},d=[{value:"What",id:"what",children:[{value:"What is JLink?",id:"what-is-jlink",children:[],level:4},{value:"What is JPackage",id:"what-is-jpackage",children:[],level:4}],level:3},{value:"How",id:"how",children:[{value:"Installation",id:"installation",children:[],level:4},{value:"Usage",id:"usage",children:[],level:4}],level:3},{value:"Why",id:"why",children:[],level:3},{value:"Alternatives",id:"alternatives",children:[{value:"&quot;Fat-JAR&quot;",id:"fat-jar",children:[],level:4},{value:"GraalVM",id:"graalvm",children:[],level:4}],level:3}],h={toc:d};function c(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"JPackage is a way to package a modern JVM-program as a installable binary, in a small format."),(0,i.kt)("h3",{id:"what"},"What"),(0,i.kt)("p",null,"JPackage was finally included in the JDK by JDK-14, originally from the JavaFX-world (to bundle your desktop apps).\nJPackage combines itself with JLink, which builds upon '",(0,i.kt)("a",{parentName:"p",href:"https://openjdk.java.net/projects/jigsaw/"},"project jigsaw"),'\', and together they form a way to create \\"native\\" binaries for JVM-projects.'),(0,i.kt)("h4",{id:"what-is-jlink"},"What is JLink?"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.oracle.com/javase/9/tools/jlink.htm"},"JLink")," is a way to assemble and optimize a set of modules and their dependencies into a custom runtime image (JRE).\nIn other words we can take a ordinary JRE, ~200 MB, and chop it down to a total size of 25-40 MB for smaller project."),(0,i.kt)("p",null,"JLink is only possible thanks to 'project jigsaw' which introduced modules and modularized the whole JRE starting from JDK-9. The Java standard library (stdlib) was modularized into 75 modules.\nAs you might guess it is even better if your own code is also modularized, but not enforced."),(0,i.kt)("h4",{id:"what-is-jpackage"},"What is JPackage"),(0,i.kt)("p",null," JPackage is the packaging suite that allows you to package your code, dependencies and the JLink-created JRE. I ended up with installation files, with a natively executable file on 60 MB for one of my smaller projects, which is really good in comparison to Electron!\nIn comparison to a C-program this might not be amazing, but you've to remember that this is completely cross-platform!"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Side-note")," all sized discussed is without any major optimizations - and there exists a lot! Finally, if you exclude the JRE you can reach sizes of KB rather than MB! But excluding the JRE enforces the user to have it locally, which might not be good UX."),(0,i.kt)("h3",{id:"how"},"How"),(0,i.kt)("p",null,"JPackage & JLink is made easy thanks to ",(0,i.kt)("a",{parentName:"p",href:"https://badass-runtime-plugin.beryx.org/releases/latest/"},"The Badass Runtime Plugin")," or ",(0,i.kt)("a",{parentName:"p",href:"https://badass-jlink-plugin.beryx.org/releases/latest/"},"The Badass JLink Plugin")," where the latter require a modular project and the former works with any project! :happy:"),(0,i.kt)("h4",{id:"installation"},"Installation"),(0,i.kt)("p",null,"Make sure you use & target JDK 14 or higher, JPackage was first included in this version. I recommend SDKMan to install & swap JDKs."),(0,i.kt)("p",null,"Then to add the ",(0,i.kt)("inlineCode",{parentName:"p"},"Badass Runtime Plugin")," I recommend using ",(0,i.kt)("inlineCode",{parentName:"p"},"gradle"),", which makes it as simple as the following."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},'plugins {\n    ...\n    id(\\"org.beryx.runtime\\") version \\"1.11.3\\" // latest version August 2020\n    ...\n}\nruntime {\n    options.set(listOf(\\"--strip-debug\\", \\"--compress\\", \\"2\\", \\"--no-header-files\\", \\"--no-man-pages\\"))\n    jpackage {\n        installerType = \\"deb\\" // https://badass-runtime-plugin.beryx.org/releases/latest/\n    }\n}\n')),(0,i.kt)("p",null,"This addition now creates the tasks required to build & bundle your app. The options added make sure that you reduce the total size by ",(0,i.kt)("em",{parentName:"p"},"a lot"),".\nI highly recommend reading the documentation, there's so many incredibly useful options - I only provide the minimum!"),(0,i.kt)("h4",{id:"usage"},"Usage"),(0,i.kt)("p",null,"By editing our ",(0,i.kt)("inlineCode",{parentName:"p"},"building.gradle.kts")," to include everything from the ",(0,i.kt)("a",{parentName:"p",href:"#Installation"},"Installation")," we can run the ",(0,i.kt)("inlineCode",{parentName:"p"},"./gradlew jpackage")," task to build our installer! "),(0,i.kt)("p",null,"I want to note again, please make sure to read the homepage - a ton of optimizations and customization exist. There exists a lot of low hanging fruit for sure, so make sure to grab it! \ud83d\ude09"),(0,i.kt)("h3",{id:"why"},"Why"),(0,i.kt)("p",null,"It's really cool to see your JVM application installable using a ",(0,i.kt)("inlineCode",{parentName:"p"},".msi"),", ",(0,i.kt)("inlineCode",{parentName:"p"},".deb")," or even a ",(0,i.kt)("inlineCode",{parentName:"p"},".dmg")," while retaining a decent enough size.\nBy using JPackage rather than GraalVM you make sure that you don't loose anything in the form of performance or functionality. As a cherry on the top, it's not just a executable file, but also includes a installer which is much better UX in my opinion. GraalVM will be discussed a bit more in ",(0,i.kt)("a",{parentName:"p",href:"#Alternatives"},"Alternatives"),"."),(0,i.kt)("p",null,"I want to re-iterate about the UX and size, which are the two main points of this."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"We bundle a JRE with the JVM-app, allowing executables without requiring Java, of your version, to be installed on the user computer already."),(0,i.kt)("li",{parentName:"ol"},"The JRE is minified to only contain required modules, about 30-40 MB on a smaller project."),(0,i.kt)("li",{parentName:"ol"},"All required dependencies are bundled also"),(0,i.kt)("li",{parentName:"ol"},"Installer which makes the whole JVM program really like any program on the computer "),(0,i.kt)("li",{parentName:"ol"},"Basically a download, install run program that isn't huge in size!")),(0,i.kt)("h3",{id:"alternatives"},"Alternatives"),(0,i.kt)("p",null,"I see two alternatives that are worth mentioning"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"FAT-JAR / Uber-JAR / Shadow-JAR "),(0,i.kt)("li",{parentName:"ol"},"GraalVM Native Image")),(0,i.kt)("h4",{id:"fat-jar"},'\\"Fat-JAR\\"'),(0,i.kt)("p",null,"A FAT-jar is a jar that bundles all dependencies and also includes a shell script, or ",(0,i.kt)("inlineCode",{parentName:"p"},".bat")," if Windows, to run the whole JVM-application.\nIt's pretty small in size, even though called FAT, as it doesn't include a JRE to run the JVM."),(0,i.kt)("p",null,"This means that if your JVM-app requires Java 11 but the user only has Java 8 you need to have them download the JRE required, which sucks."),(0,i.kt)("h4",{id:"graalvm"},"GraalVM"),(0,i.kt)("p",null," The probably best alternative, it's even smaller in size as SubstrateVM (their runtime) is really small and GraalVM allows AOT compile."),(0,i.kt)("p",null," GraalVM has ",(0,i.kt)("em",{parentName:"p"},"much")," faster startup-times than a JPackage program, but GraalVM is not as good when running for a long duration as there isn't the incredibly good JIT from JVM."),(0,i.kt)("p",null,"I'd say something along the following - for long running apps choose JPackage, for lambda etc certainly choose GraalVM."),(0,i.kt)("p",null,"But GraalVM has further negatives, you can't just code as you usually do. Reflection etc is not supported as usual, meaning there comes a lot of caveats using GraalVM."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Extra:")," I managed to end up with, after some minor trial-and-error, a binary file on ~ 12 MB for my file-sending program - pretty darn amazing!"),(0,i.kt)("p",null,"  ",(0,i.kt)("em",{parentName:"p"},"I'll write more about GraalVM and its SubstrateVM which is used to create the native binaries in a new TIL.")),(0,i.kt)("p",null,"-Hampus Lond\xf6g\xe5rd"))}c.isMDXComponent=!0}}]);