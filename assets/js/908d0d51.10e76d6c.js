"use strict";(self.webpackChunklondogard=self.webpackChunklondogard||[]).push([[2641],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),g=r,m=d["".concat(s,".").concat(g)]||d[g]||c[g]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8724:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},assets:function(){return p},toc:function(){return c},default:function(){return g}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={toc:!0,description:"A simple show-case on how to publish libraries to both _GitHub Packages_ & _JitPack_ with a one-button release using gradle & GitHub Actions.",tags:["gradle","jvm"],title:"Gradle, JVM and GitHub Packages",authors:"hlondogard"},s="Gradle, JVM and GitHub Packages",u={permalink:"/blog/2020/02/10/gradle-github-packages",editUrl:"https://github.com/londogard/londogard/blog/2020-02-10-gradle-github-packages.md",source:"@site/blog/2020-02-10-gradle-github-packages.md",title:"Gradle, JVM and GitHub Packages",description:"A simple show-case on how to publish libraries to both _GitHub Packages_ & _JitPack_ with a one-button release using gradle & GitHub Actions.",date:"2020-02-10T00:00:00.000Z",formattedDate:"February 10, 2020",tags:[{label:"gradle",permalink:"/blog/tags/gradle"},{label:"jvm",permalink:"/blog/tags/jvm"}],readingTime:2.25,truncated:!0,authors:[{name:"Hampus Lond\xf6g\xe5rd",title:"Main Contributor of Londogard",url:"https://github.com/lundez",imageURL:"https://github.com/lundez.png",key:"hlondogard"}],frontMatter:{toc:!0,description:"A simple show-case on how to publish libraries to both _GitHub Packages_ & _JitPack_ with a one-button release using gradle & GitHub Actions.",tags:["gradle","jvm"],title:"Gradle, JVM and GitHub Packages",authors:"hlondogard"},prevItem:{title:"[2019-02-04] AFRY NLP Competence Meeting: Text Classification IMDB",permalink:"/blog/2020/02/23/competence-meeting-imdb-text-classification"}},p={authorsImageUrls:[void 0]},c=[{value:"1. Add Maven Publish Plugin",id:"1-add-maven-publish-plugin",children:[],level:2},{value:"2. Add Publication Part",id:"2-add-publication-part",children:[],level:2},{value:"3. Automating Release Workflow",id:"3-automating-release-workflow",children:[],level:2}],d={toc:c};function g(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Initial comment")," this is mainly done as a reminder to myself."),(0,i.kt)("p",null,"So about 6 months ago GitHub launched a new exciting service; ",(0,i.kt)("a",{parentName:"p",href:"https://github.blog/2019-05-10-introducing-github-package-registry/"},"GitHub Package Registry"),". This service lets you as a GitHub-user upload your Open Source code for free on GitHubs registry supporting a wide array of languagues and build systems - JavaScript (npm), Java/JVM-languages (Maven/Gradle), Ruby (RubyGems), .NET (NuGet), and Docker images. Perhaps more have been added since I last verified."),(0,i.kt)("p",null,"In this post I'll try to keep to the point and give clear easy instruction that you'll be able to bookmark and go back to whenever you need to set this up."),(0,i.kt)("p",null,"I'll give the instruction directly beneath with some comments afterwards for the one who'd like to read some extra."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"1-add-maven-publish-plugin"},"1. Add Maven Publish Plugin"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle.kts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},'plugins {\n    `maven-publish` // Add this\n    kotlin(\\"jvm\\") version \\"1.3.60\\"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},'plugins {\n    id(\\"maven-publish\\")\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle")," (using the ",(0,i.kt)("em",{parentName:"p"},"old")," ",(0,i.kt)("inlineCode",{parentName:"p"},"apply")," way of things)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"apply plugin: 'maven-publish'\n")),(0,i.kt)("h2",{id:"2-add-publication-part"},"2. Add Publication Part"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle.kts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},'publishing {\n    repositories {\n        maven {\n            name = \\"GitHubPackages\\"\n            url = uri(\\"https://maven.pkg.github.com/OWNER/REPO\\")\n            credentials {\n                username = project.findProperty(\\"gpr.user\\") as String? ?: System.getenv(\\"GITHUB_ACTOR\\")\n                password = project.findProperty(\\"gpr.key\\") as String? ?: System.getenv(\\"GITHUB_TOKEN\\")\n            }\n        }\n    }\n    publications {\n        register<MavenPublication>(\\"gpr\\"){\n            from(components[\\"java\\"])\n        }\n    }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},'publishing {\n    repositories {\n        maven {\n            name = \\"GitHubPackages\\"\n            url = uri(\\"https://maven.pkg.github.com/OWNER/REPOSITORY\\")\n            credentials {\n                username = project.findProperty(\\"gpr.user\\") ?: System.getenv(\\"GITHUB_ACTOR\\")\n                password = project.findProperty(\\"gpr.key\\") ?: System.getenv(\\"GITHUB_TOKEN\\")\n            }\n        }\n    }\n    publications {\n        gpr(MavenPublication) {\n            from(components.java)\n        }\n    }\n}\n')),(0,i.kt)("h2",{id:"3-automating-release-workflow"},"3. Automating Release Workflow"),(0,i.kt)("p",null,"To simplify our lifes further;"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"JitPack is already automated and tracking your repository automatically adding the new releases ones a release is created."),(0,i.kt)("li",{parentName:"ul"},"GitHub is ",(0,i.kt)("em",{parentName:"li"},"not")," automated and we need to upload our assets")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Automating GitHub packages upload through release & GitHub Actions")),(0,i.kt)("p",null,"We'll use GitHub Actions to create a workflow where once a release passes stage 'published' the assets will be uploaded to the repository/artifactory of GitHub Packages.\nThis integration is really awesome as once we've set it up we only need to press \\\"Create Release\\\" on the GitHub page to deploy our library to both GitHub Packages & JitPack!"),(0,i.kt)("p",null,"Create the directory ",(0,i.kt)("inlineCode",{parentName:"p"},".github/workflows")," in your root-folder of the project if it doesn't exist yet. Add the following file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"name: Release & Publish Build\n\non:\n  release:\n    types: [published]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v1\n\n      - name: Set up JDK 1.8\n        uses: actions/setup-java@v1\n        with:\n          java-version: 1.8\n\n      - name: Clean Build\n        run: ./gradlew clean build\n\n      - name: Publish Build\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n        run: ./gradlew publish\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"secrets.GITHUB_TOKEN")," is automatically supplied by GitHub itself during the run of the GitHub Actions-script. "),(0,i.kt)("p",null,"Pretty awesome right? Go build your libraries and deploy!"))}g.isMDXComponent=!0}}]);