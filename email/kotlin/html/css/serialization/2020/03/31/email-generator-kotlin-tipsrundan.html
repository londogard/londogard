<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How I created a email generator in Kotlin (for Afry Tipsrundan) | Londogard</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="How I created a email generator in Kotlin (for Afry Tipsrundan)" />
<meta name="author" content="Hampus Londögård" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This blog goes through how to use Kotlin to generate good looking responsive emails. It’ll handle CSS, kotlin html DSL &amp; kotlin serialization." />
<meta property="og:description" content="This blog goes through how to use Kotlin to generate good looking responsive emails. It’ll handle CSS, kotlin html DSL &amp; kotlin serialization." />
<link rel="canonical" href="https://blog.londogard.com/email/kotlin/html/css/serialization/2020/03/31/email-generator-kotlin-tipsrundan.html" />
<meta property="og:url" content="https://blog.londogard.com/email/kotlin/html/css/serialization/2020/03/31/email-generator-kotlin-tipsrundan.html" />
<meta property="og:site_name" content="Londogard" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-31T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://blog.londogard.com/email/kotlin/html/css/serialization/2020/03/31/email-generator-kotlin-tipsrundan.html","@type":"BlogPosting","headline":"How I created a email generator in Kotlin (for Afry Tipsrundan)","dateModified":"2020-03-31T00:00:00-05:00","datePublished":"2020-03-31T00:00:00-05:00","author":{"@type":"Person","name":"Hampus Londögård"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.londogard.com/email/kotlin/html/css/serialization/2020/03/31/email-generator-kotlin-tipsrundan.html"},"description":"This blog goes through how to use Kotlin to generate good looking responsive emails. It’ll handle CSS, kotlin html DSL &amp; kotlin serialization.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.londogard.com/feed.xml" title="Londogard" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Londogard</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger"><a class="page-link" href="/about">About↗</a><a class="page-link" href="/londogard">Londogard↗</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
        </nav></div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How I created a email generator in Kotlin (for Afry Tipsrundan)</h1><p class="page-description">This blog goes through how to use Kotlin to generate good looking responsive emails. It'll handle CSS, kotlin html DSL & kotlin serialization.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-03-31T00:00:00-05:00" itemprop="datePublished">
        Mar 31, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Hampus Londögård</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#email">email</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#kotlin">kotlin</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#html">html</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#css">css</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#serialization">serialization</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#email-generation---tipsrundan--">Email Generation - Tipsrundan -</a>
<ul>
<li class="toc-entry toc-h2"><a href="#the-evolution-of-tipsrundan">The evolution of Tipsrundan</a></li>
<li class="toc-entry toc-h2"><a href="#tipsrundan-generation">Tipsrundan generation</a>
<ul>
<li class="toc-entry toc-h3"><a href="#step-1-defining-the-format">Step 1: Defining the format</a></li>
<li class="toc-entry toc-h3"><a href="#step-2-reading-the-data">Step 2: Reading the data</a></li>
<li class="toc-entry toc-h3"><a href="#step-3-how-to-write-html-in-kotlin">Step 3: How to write html in Kotlin?</a></li>
<li class="toc-entry toc-h3"><a href="#step-4-styling">Step 4: Styling</a></li>
<li class="toc-entry toc-h3"><a href="#step-5-wrapping-it-all-up">Step 5: Wrapping it all up</a></li>
</ul>
</li>
</ul>
</li>
</ul><h1 id="email-generation---tipsrundan--">
<a class="anchor" href="#email-generation---tipsrundan--" aria-hidden="true"><span class="octicon octicon-link"></span></a>Email Generation - Tipsrundan -</h1>
<p>At AFRY IT South I’m co-responsible with Hassan Ftouni at driving the competence. One of my initiatives that we both now drive is to have a biweekly, every second week for all you picky readers out there, newsletter called "Tipsrundan".</p>

<p>Tipsrundan has lately gathered some fuss around and Afry IT West now wants to join in. This means new challenges to somehow build an email together with more people, collaborating on what to have and what to keep regional. Let me say that this is a fun challenge!</p>

<p>In this post I’ll go through how I built our completely new "Email Generator" in Kotlin that I built a Sunday afternoon. This includes a few things such as</p>

<ul>
  <li>Learning how CSS works in emails (in comparison to browsers)</li>
  <li>Kotlin</li>
</ul>

<p>Let me start at how Tipsrundan has evolved since we initiated it in October (crazy how time flies).</p>

<h2 id="the-evolution-of-tipsrundan">
<a class="anchor" href="#the-evolution-of-tipsrundan" aria-hidden="true"><span class="octicon octicon-link"></span></a>The evolution of Tipsrundan</h2>
<p>When we sent the first Tipsrundan, called TL;DR back then, I used a "email templating language" called <a href="https://mjml.io/">MJML</a> and a pre-built template found on their homepage.<br>
With this we got a responsive email using their "homemade" templating language. I enjoyed it at the same time as I hated it, there was way to much manual labour copying the sections and inserting my own code, the indentation in the web-editor wasn’t great and so on. I bet it’s a great tool but it didn’t cut it for me, after two or three issues and a ton of research I found a new tool I liked, with a good free variant, called <a href="https://stripo.email/">Stripo</a>. Stripo is a <em>really</em> good tool which has excellent support with its drag n’ drop editor where you can save modules and much more. We got a good looking &amp; responsive email that worked out great, everything good right?</p>

<p>It was really good until I realized we had to share the template with new people and Stripo requires premium for this (can’t blame them, they need their cut) which honestly I was to lazy to fix through management.</p>

<p>With this knowledge I set out to create a tool which we could use internally that is simple and keeps simple. Forward comes a solution I built over a Sunday afternoon where we generate emails from JSON.</p>

<h2 id="tipsrundan-generation">
<a class="anchor" href="#tipsrundan-generation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tipsrundan generation</h2>
<p>I had some pretty simple requirement:</p>
<ol>
  <li>JSON or yaml as the filetype which we’d generate Tipsrundan-email from.</li>
  <li>Have different sections and easily extendable</li>
  <li>Decent looking &amp; responsive (i.e. work on a phone and desktop)</li>
</ol>

<p>By having these requirements I knew that it’ll be easy to sync over git or whatever tool we need and that we can potentially create themed Tipsrundan editions in the future.</p>

<p>I also knew that I wanted to do this in Kotlin, mainly because I really enjoy coding in Kotlin.</p>

<h3 id="step-1-defining-the-format">
<a class="anchor" href="#step-1-defining-the-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1: Defining the format</h3>
<p>The first step was to decide what format to use, or at least begin with. Both yaml and JSON was considered and in the end JSON felt like the best fit.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">\</span><span class="s2">"title</span><span class="se">\"</span><span class="s2">: string,
  </span><span class="se">\"</span><span class="s2">issue</span><span class="se">\"</span><span class="s2">: number,
  </span><span class="se">\"</span><span class="s2">regional</span><span class="se">\"</span><span class="s2">: [item],
  .. more categories
}
</span></code></pre></div></div>
<p>where <code class="language-plaintext highlighter-rouge">item </code> is</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">\</span><span class="s2">"title</span><span class="se">\"</span><span class="s2">: string,
  </span><span class="se">\"</span><span class="s2">description</span><span class="se">\"</span><span class="s2">: string,
  </span><span class="se">\"</span><span class="s2">url</span><span class="se">\"</span><span class="s2">: string
}
</span></code></pre></div></div>

<p>Pretty straight-forward, as I said I prefer to keep it simple.</p>

<h3 id="step-2-reading-the-data">
<a class="anchor" href="#step-2-reading-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Reading the data</h3>
<p>Now that we have a definition of the data we need to read it, this is really a solved problem in most languages through some kind of library. In my case I choose the serialization library provided by Kotlin in the <code class="language-plaintext highlighter-rouge">kotlinx</code>-library. As a FYI this library can serialize using CBOR (Concise Binary Object Representation) and other formats. The name of the library is <code class="language-plaintext highlighter-rouge">kotlinx-serialization</code> and can be found <a href="https://github.com/Kotlin/kotlinx.serialization">here</a>. It’s easiest installed through <code class="language-plaintext highlighter-rouge">gradle</code> (using the Kotlin DSL):</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plugins</span> <span class="p">{</span>
  <span class="nf">kotlin</span><span class="p">(</span><span class="err">\</span><span class="s">"plugin.serialization\") version \"1.3.70\" // same version as kotlin
</span><span class="p">}</span>

<span class="nf">dependencies</span> <span class="p">{</span>
  <span class="o">..</span> <span class="n">other</span> <span class="n">dependencies</span>
  <span class="nf">implementation</span><span class="p">(</span><span class="err">\</span><span class="s">"org.jetbrains.kotlinx:kotlinx-serialization-runtime:0.20.0\") // Requires jcenter() as a repository
</span><span class="p">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">kotlinx-serialization</code> is actually cross-platform compatible meaning that it exists for Kotlin targeting JVM, Native &amp; JS (yes we can target all these platforms through Kotlin!).</p>

<p>Once installed it’s pretty easy to serialize &amp; deserialize, like any other library really. Create the <code class="language-plaintext highlighter-rouge">data class</code>es, which is the equivalent of a <code class="language-plaintext highlighter-rouge">case class</code> in Scala.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Item</span><span class="p">(</span><span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
</code></pre></div></div>
<p>Currently <code class="language-plaintext highlighter-rouge">kotlinx-serialization</code> can do the serialization through two different methods, either add an annotation to the class that we’ll use Reflection - this does not work for native. Or we mark the <code class="language-plaintext highlighter-rouge">data class</code> as Serializable, the latter being preferred as it’s  truly cross-platform and is more performant. 
If anyone is wondering a  <code class="language-plaintext highlighter-rouge">data class</code> is basically a class that   provides setters, getters, equality, toString and more! It’s really awesome.
Adding the annotation we end up with the following:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">Item</span><span class="p">(</span><span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="step-3-how-to-write-html-in-kotlin">
<a class="anchor" href="#step-3-how-to-write-html-in-kotlin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: How to write html in Kotlin?</h3>

<p>We all probably know about html-templating that’s available in most languages, I decided against that and went for a DSL. Kotlin is the language for DSL (Domain Specific Language), for good and bad. Through yet another <code class="language-plaintext highlighter-rouge">kotlinx</code> library we got <code class="language-plaintext highlighter-rouge">kotlinx-html</code> which provides this DSL.</p>

<p>It looks something like this</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nc">BODY</span><span class="p">.</span><span class="nf">createFooter</span><span class="p">()</span> <span class="p">=</span> <span class="nf">footer</span> <span class="p">{</span>
    <span class="nf">hr</span> <span class="p">{</span> <span class="p">}</span>
    <span class="nf">section</span> <span class="p">{</span>
        <span class="nf">p</span> <span class="p">{</span>
            <span class="nf">b</span> <span class="p">{</span> <span class="p">+</span><span class="err">\</span><span class="s">"Thank you for this time see you in two weeks\" }
</span>            <span class="nf">br</span> <span class="p">{</span> <span class="p">}</span>
            <span class="p">+</span><span class="err">\</span><span class="s">"Hampus &amp; Hassan\"
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By using a DSL we get types (as you can see on the <code class="language-plaintext highlighter-rouge">BODY</code>) and other bonuses. Although this DSL is pretty verbose it works pretty good. In the end using a DSL or html-template engine does not matter that much in my opinion.
By the way, the way this function is typed is called a <code class="language-plaintext highlighter-rouge">extension function</code> in Kotlin and is one of my favorite tools. It means that we extend the class, <code class="language-plaintext highlighter-rouge">BODY</code> with a new method which is usable on a object of the class. Cool right?</p>

<p>Let’s move on to the styling and how CSS can be annoying.</p>

<h3 id="step-4-styling">
<a class="anchor" href="#step-4-styling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4: Styling</h3>

<p>There was some important parts going into this, we want the email to look at least decent and also be responsive so that it’s viewable on both a phone and computer.</p>

<p>CSS and emails are not as simple as with a webpage I learned rather fast. I had great issues actually getting the HTML to look good in gmail/outlook. In the end I found <a href="https://litmus.com/blog/do-email-marketers-and-designers-still-need-to-inline-css">this</a> awesome post from Litmus which is one of the leading Email Marketing providers. I learned that</p>

<ol>
  <li>External CSS is a no-go for emails (a lot of the providers turned it off because of security concerns)</li>
  <li>Embedded CSS (using <code class="language-plaintext highlighter-rouge">style</code>-tag in the header) works on most places today (not true a few years ago)</li>
  <li>Inline CSS is the best</li>
</ol>

<p>Because I want to keep it simple I went with the second approach, this mean that I can keep the code a bit cleaner and not write as many wrappers for the styled elements.</p>

<p>So knowing how I should implement my styling I needed to find a good style, in the end I remembered an old Reddit-post where I found "MVP.css" which is a small CSS that gives cards, buttons and more. Really brilliant in my opinion, made by Andy Brewer and can be found <a href="https://andybrewer.github.io/mvp/">here</a>. I’ve personally tweaked it a bit to keep the email a bit more compact and informative as this is really made for webpages, but the essentials are the same.</p>

<h3 id="step-5-wrapping-it-all-up">
<a class="anchor" href="#step-5-wrapping-it-all-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5: Wrapping it all up</h3>

<p>Combining all this into a few files in a git repo we can now generate emails from a JSON easily and have multiple categories.</p>

<ul>
  <li>The JSON is used as a data structure</li>
  <li>Kotlin used as language</li>
  <li>
<code class="language-plaintext highlighter-rouge">kotlinx-serialization</code> used as a JSON deserializer</li>
  <li>
<code class="language-plaintext highlighter-rouge">kotlinx-html</code> used to build the HTML directly in Kotlin with types</li>
  <li>Embedded CSS used as it’s widely usable by today in email clients</li>
</ul>

<p>The repository can be found <a href="https://github.com/londogard/email-gen-kt">here</a>.</p>

<p>I hope this was somewhat interesting &amp; something learned. If you’ve any comments please reach out to me through any of the available channels!</p>

<p><em>Hampus Londögård</em></p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="londogard/londogard"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/email/kotlin/html/css/serialization/2020/03/31/email-generator-kotlin-tipsrundan.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog with a focus on Deep Learning, JVM and Performance.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/londogard" title="londogard"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
